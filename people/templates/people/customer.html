{%extends 'landing/base.html'%}
{%load static%}


{%block head%}

<title>Customers</title>

{%endblock%}



{%block body%}

<div class="page-wrapper">
				<div class="content">
					<div class="page-header">
						<div class="add-item d-flex">
							<div class="page-title">
								<h4 class="fw-bold">Customers</h4>
								<h6>Manage your customers</h6>
                                <br>
					{% if messages %}
					{% for message in messages %}
					{% if message.tags == 'error' %}
					<!-- Error Alert -->
					<div class="alert alert-solid-danger alert-dismissible fade show">
						{{message}}
						<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"><i
								class="fas fa-xmark"></i></button>
					</div>
					{% elif message.tags == 'success' %}
					<!-- Success Alert -->
					<div class="alert alert-solid-success alert-dismissible fade show">
						{{message}}
						<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"><i
								class="fas fa-xmark"></i></button>
					</div>
					{% endif %}
					{% endfor %}
					{% endif %}
							</div>
						</div>
						<ul class="table-top-head">
							<!-- <li>
								<a data-bs-toggle="tooltip" data-bs-placement="top" title="Pdf"><img src="{%static 'landing/assets/img/icons/pdf.svg'%}" alt="img"></a>
							</li>
							<li>
								<a data-bs-toggle="tooltip" data-bs-placement="top" title="Excel"><img src="{%static 'landing/assets/img/icons/excel.svg'%}" alt="img"></a>
							</li> -->
							<li>
								<a href="{%url 'people:customers'%}" data-bs-toggle="tooltip" data-bs-placement="top" title="Refresh"><i class="ti ti-refresh"></i></a>
							</li>
							<li>
								<a data-bs-toggle="tooltip" data-bs-placement="top" title="Collapse" id="collapse-header"><i class="ti ti-chevron-up"></i></a>
							</li>
						</ul>
						<div class="page-btn">
							<a href="#" class="btn btn-primary text-white" data-bs-toggle="modal" data-bs-target="#add-customer"><i class="ti ti-circle-plus me-1"></i>Add Customer</a>
						</div>
					</div>
					<!-- /product list -->
					<div class="card">
						<div class="card-header d-flex align-items-center justify-content-between flex-wrap row-gap-3">
							<div class="search-set">
								<div class="search-input">
									<span class="btn-searchset"><i class="ti ti-search fs-14 feather-search"></i></span>
								</div>
							</div>
							<div class="d-flex table-dropdown my-xl-auto right-content align-items-center flex-wrap row-gap-3">
										
								<div class="dropdown">
									<a href="javascript:void(0);" class="dropdown-toggle btn btn-white btn-md d-inline-flex align-items-center" data-bs-toggle="dropdown">
										Status
									</a>
									<ul class="dropdown-menu  dropdown-menu-end p-3">
										<li>
											<a href="javascript:void(0);" class="dropdown-item rounded-1">Active</a>
										</li>
										<li>
											<a href="javascript:void(0);" class="dropdown-item rounded-1">Inactive</a>
										</li>
							
									</ul>
								</div>
							</div>
						</div>
						<div class="card-body p-0">	
							<div class="table-responsive">
								<table class="table datatable">
									<thead class="thead-light">
										<tr>
											<th class="no-sort">
												<label class="checkboxs">
													<input type="checkbox" id="select-all">
													<span class="checkmarks"></span>
												</label>
											</th>
											<th>Code</th>
											<th>Customer</th>
											<th>Email</th>
											<th>Phone</th>
											<th>Country</th>
											<th>Status</th>
											<th class="no-sort"></th>
										</tr>
									</thead>
									<tbody>
                                       {% for customer in page_obj %}
    <tr>
      <td>
        <label class="checkboxs">
          <input type="checkbox">
          <span class="checkmarks"></span>
        </label>
      </td>
      <td>#{{ customer.code }}</td>
      <td>
        <div class="d-flex align-items-center">
          <a class="avatar avatar-md me-2">
            <img src="{{ customer.image.url }}" alt="{{ customer.name }}">
          </a>
          {{ customer.name }}
        </div>
      </td>
      <td>{{ customer.email }}</td>
      <td>{{ customer.phone }}</td>
      <td>{{ customer.country }}</td>
      <td>
        {% if customer.status %}
          <span class="badge bg-success">Active</span>
        {% else %}
          <span class="badge bg-secondary">Inactive</span>
        {% endif %}
      </td>
      <td class="d-flex">
        <div class="edit-delete-action">
          <!-- EDIT -->
          <a href="#" class="btn btn-sm btn-light me-1"
             data-bs-toggle="modal"
             data-bs-target="#edit-customer-modal"
             data-id="{{ customer.id }}"
             data-code="{{ customer.code }}"
             data-name="{{ customer.name }}"
             data-email="{{ customer.email }}"
             data-phone="{{ customer.phone }}"
             data-country="{{ customer.country }}"
             data-status="{{ customer.status|yesno:'on,' }}">
            <i data-feather="edit"></i>
          </a>
          <!-- DELETE -->
          <a href="#" class="btn btn-sm btn-light"
             data-bs-toggle="modal"
             data-bs-target="#delete-customer-modal"
             data-id="{{ customer.id }}"
             data-name="{{ customer.name }}">
            <i data-feather="trash-2"></i>
          </a>
        </div>
      </td>
    </tr>
  {% endfor %}
									
									</tbody>
								</table>
							</div>
						</div>
					</div>
					<!-- /product list -->
				</div>
				<div class="footer d-sm-flex align-items-center justify-content-between border-top bg-white p-3">
                    <p class="mb-0 text-gray-9">2025 &copy; TwovenPOS. All Right Reserved</p>
                    <p>Designed &amp; Developed by <a href="javascript:void(0);" class="text-primary">Twoven</a></p>
                </div>
			</div>


            <!-- Add Customer -->
		<div class="modal fade" id="add-customer">
			<div class="modal-dialog modal-dialog-centered">
				<div class="modal-content">
					<div class="modal-header">
						<div class="page-title">
							<h4>Add Customer</h4>
						</div>
						<button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<form action="{%url 'people:create-customer'%}" method="post" enctype="multipart/form-data">
                        {%csrf_token%}
						<div class="modal-body">
							<div class="new-employee-field">
								<div class="profile-pic-upload">
									<div class="mb-3">
										<div class="image-upload mb-0">
											<input name="image" type="file">
											<div class="image-uploads">
												<h4>Upload Image</h4>
											</div>
										</div>
										<p class="mt-2">JPEG, PNG up to 2 MB</p>
									</div>
								</div>
							</div>
							<div class="row">
								<div class="col-lg-6 mb-3">
									<label class="form-label">Name<span class="text-danger ms-1">*</span></label>
									<input type="text" class="form-control" name="name"> 
								</div>
								<div class="col-lg-12 mb-3">
									<label class="form-label">Email<span class="text-danger ms-1">*</span></label>
									<input type="email" name="email" class="form-control"> 
								</div>
								<div class="col-lg-12 mb-3">
									<label class="form-label">Phone<span class="text-danger ms-1">*</span></label>
									<input type="tel" name="phone" class="form-control"> 
								</div>
								<div class="col-lg-12 mb-3">
									<label class="form-label">Country<span class="text-danger ms-1">*</span></label>
									<input type="text" name="country" class="form-control"> 
								</div>
								<div class="col-lg-12">
									<div class="status-toggle modal-status d-flex justify-content-between align-items-center">
										<span class="status-label">Status</span>
										<input type="checkbox" id="user1" class="check" checked="" name="status">
										<label for="user1" class="checktoggle">	</label>
									</div>
								</div>				
							</div>	
						</div>
						<div class="modal-footer">
							<button type="button" class="btn me-2 btn-secondary fs-13 fw-medium p-2 px-3 shadow-none" data-bs-dismiss="modal">Cancel</button>
							<button type="submit" class="btn btn-primary fs-13 fw-medium p-2 px-3">Add Customer</button>
						</div>
					</form>
				</div>
			</div>
		</div>
		<!-- /Add Customer -->

        <!-- Edit Customer -->
		<div class="modal fade" id="edit-customer-modal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <form method="POST" enctype="multipart/form-data" id="editCustomerForm" action="{% url 'people:edit-customer' 0 %}">
        {% csrf_token %}
        <div class="modal-header">
          <h4>Edit Customer</h4>
          <button type="button" class="close" data-bs-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
          <input type="hidden" name="id" id="edit-customer-id">
          <div class="mb-3">
            <label class="form-label">Code</label>
            <input type="text" name="code" id="edit-customer-code" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Name</label>
            <input type="text" name="name" id="edit-customer-name" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Email</label>
            <input type="email" name="email" id="edit-customer-email" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Phone</label>
            <input type="text" name="phone" id="edit-customer-phone" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Country</label>
            <input type="text" name="country" id="edit-customer-country" class="form-control" required>
          </div>
          <div class="mb-3 form-check">
            <input type="checkbox" class="form-check-input" name="status" id="edit-customer-status">
            <label class="form-check-label" for="edit-customer-status">Active</label>
          </div>
          <div class="mb-3">
            <label class="form-label">Image</label>
            <input type="file" name="image" class="form-control">
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Changes</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Delete Customer Modal -->
<div class="modal fade" id="delete-customer-modal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <form method="POST" id="deleteCustomerForm" action="{% url 'people:delete-customer' 0 %}">
        {% csrf_token %}
        <div class="modal-body text-center p-5">
          <i class="ti ti-trash fs-24 text-danger mb-2"></i>
          <h4>Delete Customer</h4>
          <p>Are you sure you want to delete <strong id="delete-customer-name"></strong>?</p>
        </div>
        <div class="modal-footer justify-content-center">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-danger">Yes, Delete</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Populate modals via JavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function () {
  // EDIT
  var editModal = document.getElementById('edit-customer-modal');
  editModal.addEventListener('show.bs.modal', function (e) {
    var btn  = e.relatedTarget;
    var id   = btn.dataset.id;
    var code = btn.dataset.code;
    var name = btn.dataset.name;
    var email= btn.dataset.email;
    var phone= btn.dataset.phone;
    var country= btn.dataset.country;
    var status = btn.dataset.status === 'on';

    // fill fields
    document.getElementById('edit-customer-id').value      = id;
    document.getElementById('edit-customer-code').value    = code;
    document.getElementById('edit-customer-name').value    = name;
    document.getElementById('edit-customer-email').value   = email;
    document.getElementById('edit-customer-phone').value   = phone;
    document.getElementById('edit-customer-country').value = country;
    document.getElementById('edit-customer-status').checked= status;

    // update form action
    var form = document.getElementById('editCustomerForm');
    form.action = form.action.replace('/0/', '/' + id + '/');
  });

  // DELETE
  var deleteModal = document.getElementById('delete-customer-modal');
  deleteModal.addEventListener('show.bs.modal', function (e) {
    var btn  = e.relatedTarget;
    var id   = btn.dataset.id;
    var name = btn.dataset.name;

    document.getElementById('delete-customer-name').textContent = name;
    var form = document.getElementById('deleteCustomerForm');
    form.action = form.action.replace('/0/', '/' + id + '/');
  });
});
</script>
{%endblock%}