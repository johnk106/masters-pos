{%extends 'landing/base.html'%}
{%load static%}



{%block head%}

<title>Variants</title>

{%endblock%}



{%block body%}

<div class="page-wrapper">
	<div class="content">
		<div class="page-header">
			<div class="add-item d-flex">
				<div class="page-title">
					<h4 class="fw-bold">Variant Attributes</h4>
					<h6>Manage your variant attributes</h6>
					<br>
					{% if messages %}
					{% for message in messages %}
					{% if message.tags == 'error' %}
					<!-- Error Alert -->
					<div class="alert alert-solid-danger alert-dismissible fade show">
						{{message}}
						<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"><i
								class="fas fa-xmark"></i></button>
					</div>
					{% elif message.tags == 'success' %}
					<!-- Success Alert -->
					<div class="alert alert-solid-success alert-dismissible fade show">
						{{message}}
						<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"><i
								class="fas fa-xmark"></i></button>
					</div>
					{% endif %}
					{% endfor %}
					{% endif %}
				</div>
			</div>
			<ul class="table-top-head">
				<li>
					<a data-bs-toggle="tooltip" data-bs-placement="top" title="Pdf" href="{{ export_pdf_url }}"><img
							src="{%static 'landing/assets/img/icons/pdf.svg'%}" alt="img"></a>
				</li>
				<li>
					<a data-bs-toggle="tooltip" data-bs-placement="top" title="Excel" href="{{ export_excel_url }}"><img
							src="{%static 'landing/assets/img/icons/excel.svg'%}" alt="img"></a>
				</li>
				<li>
					<a data-bs-toggle="tooltip" data-bs-placement="top" title="Refresh"><i
							class="ti ti-refresh"></i></a>
				</li>
				<li>
					<a data-bs-toggle="tooltip" data-bs-placement="top" title="Collapse" id="collapse-header"><i
							class="ti ti-chevron-up"></i></a>
				</li>
			</ul>
			<div class="page-btn">
				<a href="#" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#add-variant"><i
						class="ti ti-circle-plus me-1"></i>Add Variant</a>
			</div>
		</div>
		<!-- /product list -->
		<div class="card">
			<div class="card-header d-flex align-items-center justify-content-between flex-wrap row-gap-3">
				<div class="search-set">
					<div class="search-input">
						<span class="btn-searchset"><i class="ti ti-search fs-14 feather-search"></i></span>
					</div>
				</div>
				<div class="table-dropdown my-xl-auto right-content">
					<div class="dropdown">
						<a href="javascript:void(0);"
							class="dropdown-toggle btn btn-white btn-md d-inline-flex align-items-center"
							data-bs-toggle="dropdown">
							Status
						</a>
						<ul class="dropdown-menu  dropdown-menu-end p-3">
							<li>
								<a href="javascript:void(0);" class="dropdown-item rounded-1">Active</a>
							</li>
							<li>
								<a href="javascript:void(0);" class="dropdown-item rounded-1">Inactive</a>
							</li>
						</ul>
					</div>
				</div>
			</div>
			<div class="card-body p-0">
				<div class="table-responsive">
					<table class="table datatable">
						<thead class="thead-light">
							<tr>
								<th class="no-sort">
									<label class="checkboxs">
										<input type="checkbox" id="select-all">
										<span class="checkmarks"></span>
									</label>
								</th>
								<th>Variant</th>
								<th>Values</th>
								<th>Created Date</th>
								<th>Status</th>
								<th class="no-sort"></th>
							</tr>
						</thead>
						<tbody>
							{% for variant in page_obj %}
							<tr>
								<td>
									<label class="checkboxs">
										<input type="checkbox">
										<span class="checkmarks"></span>
									</label>
								</td>

								<td class="text-gray-9">{{ variant.name }}</td>
								<td>{{ variant.values }}</td>
								<td>{{ variant.date_created }}</td>

								{% if variant.status %}
								<td><span class="badge table-badge bg-success fw-medium fs-10">Active</span></td>
								{% else %}
								<td><span class="badge table-badge bg-secondary fw-medium fs-10">Inactive</span></td>
								{% endif %}

								<td class="action-table-data">
									<div class="edit-delete-action">

										<!-- EDIT BUTTON -->
										<a href="#" class="me-2 p-2 btn-edit-variant" data-bs-toggle="modal"
											data-bs-target="#edit-variant-modal" data-id="{{ variant.id }}"
											data-name="{{ variant.name }}" data-values="{{ variant.values }}"
											data-status="{{ variant.status|yesno:'true,false' }}">
											<i data-feather="edit" class="feather-edit"></i>
										</a>

										<!-- DELETE BUTTON -->
										<a href="#" class="p-2 btn-delete-variant" data-bs-toggle="modal"
											data-bs-target="#delete-variant-modal" data-id="{{ variant.id }}"
											data-name="{{ variant.name }}">
											<i data-feather="trash-2" class="feather-trash-2"></i>
										</a>

									</div>
								</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			</div>
		</div>
		<!-- /product list -->
	</div>
	<div class="footer d-sm-flex align-items-center justify-content-between border-top bg-white p-3">
		<p class="mb-0 text-gray-9">22025 &copy; Twoven Ecommerce. All Right Reserved</p>
		<p>Designed &amp; Developed by <a href="javascript:void(0);" class="text-primary">Twoven</a></p>
	</div>
</div>
<!-- Add Unit -->
<div class="modal fade" id="add-variant">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-header">
				<div class="page-title">
					<h4>Add Variant</h4>
				</div>
				<button type="button" class="close bg-danger text-white fs-16" data-bs-dismiss="modal"
					aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<form action="{%url 'inventory:create-variant'%}" method="post">
				{%csrf_token%}
				<div class="modal-body">
					<div class="mb-3">
						<label class="form-label">Variant<span class="text-danger ms-1">*</span></label>
						<input type="text" name="name" class="form-control">
					</div>
					<div class="mb-3">
						<label class="form-label">Values<span class="text-danger ms-1">*</span></label>
						<input class="form-control" type="text" name="values" value="">
						<span class="tag-text mt-2 d-flex">Enter value separated by comma</span>
					</div>
					<div class="mb-0 mt-4">
						<div class="status-toggle modal-status d-flex justify-content-between align-items-center">
							<span class="status-label">Status</span>
							<input type="checkbox" id="user2" class="check" checked="">
							<label for="user2" class="checktoggle"></label>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn me-2 btn-secondary" data-bs-dismiss="modal">Cancel</button>
					<button type="submit" class="btn btn-primary">Add Variant</button>
				</div>
			</form>
		</div>
	</div>
</div>
<!-- /Add Unit -->

<!-- Edit Unit -->
<!-- Edit Variant Modal -->
<div class="modal fade" id="edit-variant-modal" tabindex="-1" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">

			<div class="modal-header">
				<div class="page-title">
					<h4>Edit Variant</h4>
				</div>
				<button type="button" class="btn-close bg-danger text-white" data-bs-dismiss="modal"
					aria-label="Close"></button>
			</div>

			<!-- We’ll set action="/inventory/variants/<id>/edit/" in JS -->
			<form id="editVariantForm" method="POST" action="">
				{% csrf_token %}
				<div class="modal-body">

					<!-- Optional hidden input for variant ID -->
					<input type="hidden" name="variant_id" id="edit-variant-id" />

					<div class="mb-3">
						<label for="edit-variant-name" class="form-label">
							Variant<span class="text-danger ms-1">*</span>
						</label>
						<input type="text" class="form-control" id="edit-variant-name" name="name" required />
					</div>

					<div class="mb-3">
						<label for="edit-variant-values" class="form-label">
							Values<span class="text-danger ms-1">*</span>
						</label>
						<input type="text" class="form-control" id="edit-variant-values" name="values"
							placeholder="Enter values separated by comma" required />
						<span class="tag-text mt-2 d-flex">
							Enter values separated by comma
						</span>
					</div>

					<div class="mb-3">
						<div class="status-toggle d-flex justify-content-between align-items-center">
							<span class="status-label">Status</span>
							<!-- If you want “True”/“False” in POST, add a hidden fallback. Example below: -->
							<input type="hidden" name="status" value="False" />
							<input type="checkbox" id="edit-variant-status" name="status" value="True" class="check" />
							<label for="edit-variant-status" class="checktoggle"></label>
						</div>
					</div>

				</div>

				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
						Cancel
					</button>
					<button type="submit" class="btn btn-primary">Save Changes</button>
				</div>
			</form>

		</div>
	</div>
</div>

<!-- /Edit Unit -->
<!-- delete modal -->
<!-- Delete Variant Modal -->
<div class="modal fade" id="delete-variant-modal" tabindex="-1" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="page-wrapper-new p-0">
				<div class="content p-5 px-3 text-center">
					<span class="rounded-circle d-inline-flex p-2 bg-danger-transparent mb-2">
						<i class="ti ti-trash fs-24 text-danger"></i>
					</span>
					<h4 class="fs-20 fw-bold mb-2 mt-1">Delete Variant</h4>
					<p class="mb-0 fs-16">
						Are you sure you want to delete <span id="delete-variant-name" class="fw-medium"></span>?
					</p>

					<!-- We’ll set action="/inventory/variants/<id>/delete/" in JS -->
					<form id="deleteVariantForm" method="POST" action="">
						{% csrf_token %}
						<div class="modal-footer-btn mt-3 d-flex justify-content-center">
							<button type="button" class="btn btn-secondary fs-13 fw-medium p-2 px-3 shadow-none me-2"
								data-bs-dismiss="modal">
								Cancel
							</button>
							<button type="submit" class="btn btn-danger fs-13 fw-medium p-2 px-3">
								Yes, Delete
							</button>
						</div>
					</form>

				</div>
			</div>
		</div>
	</div>
</div>
<script>
	document.addEventListener('DOMContentLoaded', function () {
		//
		// 1) EDIT VARIANT MODAL
		//
		var editVariantModal = document.getElementById('edit-variant-modal');
		if (editVariantModal) {
			editVariantModal.addEventListener('show.bs.modal', function (event) {
				// The <a class="btn-edit-variant"> that triggered this modal:
				var button = event.relatedTarget;

				// Read data-* from that button:
				var variantId = button.getAttribute('data-id');
				var variantName = button.getAttribute('data-name');
				var variantValues = button.getAttribute('data-values');
				var variantStatus = button.getAttribute('data-status'); // "true" or "false"

				// Find form inputs inside the modal:
				var form = document.getElementById('editVariantForm');
				var inputHiddenId = document.getElementById('edit-variant-id');
				var inputName = document.getElementById('edit-variant-name');
				var inputValues = document.getElementById('edit-variant-values');
				var inputStatus = document.getElementById('edit-variant-status');

				// Populate the hidden ID (if needed):
				if (inputHiddenId) {
					inputHiddenId.value = variantId;
				}

				// Populate text fields:
				if (inputName) {
					inputName.value = variantName;
				}
				if (inputValues) {
					inputValues.value = variantValues;
				}

				// Set the status checkbox (true → checked, false → unchecked):
				if (inputStatus) {
					inputStatus.checked = (variantStatus === 'true');
				}

				// Build the correct form.action URL.
				// In your Django template, you should have something like:
				//   {% url "inventory:edit-variant" 0 %}
				// which renders e.g. "/inventory/variants/0/edit/".
				var editUrlTemplate = '{% url "inventory:edit-variant" 0 %}';
				// Replace "/0/" with "/" + variantId + "/"
				var realEditUrl = editUrlTemplate.replace('/0/', '/' + variantId + '/');
				form.action = realEditUrl;
			});
		}

		//
		// 2) DELETE VARIANT MODAL
		//
		var deleteVariantModal = document.getElementById('delete-variant-modal');
		if (deleteVariantModal) {
			deleteVariantModal.addEventListener('show.bs.modal', function (event) {
				var button = event.relatedTarget;
				var variantId = button.getAttribute('data-id');
				var variantName = button.getAttribute('data-name');

				// Write the variantName into the <span id="delete-variant-name">
				var namePlaceholder = document.getElementById('delete-variant-name');
				if (namePlaceholder) {
					namePlaceholder.textContent = variantName;
				}

				// Set the form’s action to the correct “delete” URL:
				// In your Django template: {% url "inventory:delete-variant" 0 %}
				// might render "/inventory/variants/0/delete/".
				var form = document.getElementById('deleteVariantForm');
				var deleteUrlTemplate = '{% url "inventory:delete-variant" 0 %}';
				var realDeleteUrl = deleteUrlTemplate.replace('/0/', '/' + variantId + '/');
				form.action = realDeleteUrl;
			});
		}
	});
</script>


{%endblock%}