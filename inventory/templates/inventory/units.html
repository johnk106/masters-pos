{%extends 'landing/base.html'%}
{%load static%}


{%block head%}

<title>Units</title>

{%endblock%}


{%block body%}

<div class="page-wrapper">
	<div class="content">
		<div class="page-header">
			<div class="add-item d-flex">
				<div class="page-title">
					<h4 class="fw-bold">Units</h4>
					<h6>Manage your units</h6>
					{% if messages %}
					{% for message in messages %}
					{% if message.tags == 'error' %}
					<!-- Error Alert -->
					<div class="alert alert-solid-danger alert-dismissible fade show">
						{{message}}
						<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"><i
								class="fas fa-xmark"></i></button>
					</div>
					{% elif message.tags == 'success' %}
					<!-- Success Alert -->
					<div class="alert alert-solid-success alert-dismissible fade show">
						{{message}}
						<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"><i
								class="fas fa-xmark"></i></button>
					</div>
					{% endif %}
					{% endfor %}
					{% endif %}
				</div>
			</div>
			<ul class="table-top-head">
			<li>
					<a data-bs-toggle="tooltip" data-bs-placement="top" title="Pdf" href="{{ export_pdf_url }}"><img
							src="{%static 'landing/assets/img/icons/pdf.svg'%}" alt="img"></a>
				</li>
				<li>
					<a data-bs-toggle="tooltip" data-bs-placement="top" title="Excel" href="{{ export_excel_url }}"><img
							src="{%static 'landing/assets/img/icons/excel.svg'%}" alt="img"></a>
				</li>
				<li>
					<a data-bs-toggle="tooltip" data-bs-placement="top" title="Refresh"><i
							class="ti ti-refresh"></i></a>
				</li>
				<li>
					<a data-bs-toggle="tooltip" data-bs-placement="top" title="Collapse" id="collapse-header"><i
							class="ti ti-chevron-up"></i></a>
				</li>
			</ul>
			<div class="page-btn">
				<a href="#" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#add-units"><i
						class="ti ti-circle-plus me-1"></i>Add Unit</a>
			</div>
		</div>

		<div class="card">
			<div class="card-header d-flex align-items-center justify-content-between flex-wrap row-gap-3">
				<div class="search-set">
					<div class="search-input">
						<span class="btn-searchset"><i class="ti ti-search fs-14 feather-search"></i></span>
					</div>
				</div>
				<div class="table-dropdown my-xl-auto right-content">
					<div class="dropdown">
						<a href="javascript:void(0);"
							class="dropdown-toggle btn btn-white btn-md d-inline-flex align-items-center"
							data-bs-toggle="dropdown">
							Status
						</a>
						<ul class="dropdown-menu  dropdown-menu-end p-3">
							<li>
								<a href="javascript:void(0);" class="dropdown-item rounded-1">Active</a>
							</li>
							<li>
								<a href="javascript:void(0);" class="dropdown-item rounded-1">Inactive</a>
							</li>
						</ul>
					</div>
				</div>
			</div>
			<div class="card-body p-0">
				<div class="table-responsive">
					<table class="table datatable">
						<thead class="thead-light">
							<tr>
								<th class="no-sort">
									<label class="checkboxs">
										<input type="checkbox" id="select-all">
										<span class="checkmarks"></span>
									</label>
								</th>
								<th>Unit</th>
								<th>Short name</th>
								<th>No of Products</th>
								<th>Created Date</th>
								<th>Status</th>
								<th class="no-sort"></th>
							</tr>
						</thead>
						<tbody>

							{% for unit in page_obj %}
							<tr>
								<td>
									<label class="checkboxs">
										<input type="checkbox">
										<span class="checkmarks"></span>
									</label>
								</td>

								<!-- Unit Name -->
								<td class="text-gray-9">{{ unit.name }}</td>
								<!-- Short Name -->
								<td>{{ unit.short_name }}</td>
								<!-- Product Count -->
								<td>{{ unit.products.count }}</td>
								<!-- Date Created -->
								<td>{{ unit.date_created }}</td>
								<!-- Status badge -->
								{% if unit.status %}
								<td><span class="badge table-badge bg-success fw-medium fs-10">Active</span></td>
								{% else %}
								<td><span class="badge table-badge bg-secondary fw-medium fs-10">Inactive</span></td>
								{% endif %}

								<td class="action-table-data">
									<div class="edit-delete-action">

										<!-- EDIT BUTTON -->
										<a href="#" class="me-2 p-2 btn-edit-unit" data-bs-toggle="modal"
											data-bs-target="#edit-unit-modal" data-id="{{ unit.id }}"
											data-name="{{ unit.name }}" data-short-name="{{ unit.short_name }}"
											data-status="{{ unit.status|yesno:'true,false' }}">
											<i data-feather="edit" class="feather-edit"></i>
										</a>

										<!-- DELETE BUTTON -->
										<a href="#" class="p-2 btn-delete-unit" data-bs-toggle="modal"
											data-bs-target="#delete-unit-modal" data-id="{{ unit.id }}"
											data-name="{{ unit.name }}">
											<i data-feather="trash-2" class="feather-trash-2"></i>
										</a>

									</div>
								</td>
							</tr>
							{% endfor %}

						</tbody>
					</table>
				</div>
			</div>
		</div>
		<!-- /product list -->
	</div>
	<div class="footer d-sm-flex align-items-center justify-content-between border-top bg-white p-3">
		<p class="mb-0 text-gray-9">22025 &copy; Twoven Ecommerce. All Right Reserved</p>
		<p>Designed &amp; Developed by <a href="javascript:void(0);" class="text-primary">Twoven</a></p>
	</div>
</div>

<!-- Add Unit -->
<div class="modal fade" id="add-units">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-header">
				<div class="page-title">
					<h4>Add Unit</h4>
				</div>
				<button type="button" class="close bg-danger text-white fs-16" data-bs-dismiss="modal"
					aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<form action="{%url 'inventory:create-unit'%}" method="post">
				{%csrf_token%}
				<div class="modal-body">
					<div class="mb-3">
						<label class="form-label">Unit<span class="text-danger ms-1">*</span></label>
						<input type="text" name="name" class="form-control">
					</div>
					<div class="mb-3">
						<label class="form-label">Short Name<span class="text-danger ms-1">*</span></label>
						<input type="text" name="short_name" class="form-control">
					</div>
					<div class="mb-0">
						<div class="status-toggle modal-status d-flex justify-content-between align-items-center">
							<span class="status-label">Status</span>
							<input type="checkbox" id="user2" class="check" checked="">
							<label for="user2" class="checktoggle"></label>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn me-2 btn-secondary" data-bs-dismiss="modal">Cancel</button>
					<button type="submit" class="btn btn-primary">Add Unit</button>
				</div>
			</form>
		</div>
	</div>
</div>
<!-- /Add Unit -->

<!-- Edit Unit -->
<!-- Edit Unit Modal -->
<div class="modal fade" id="edit-unit-modal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header">
        <div class="page-title">
          <h4>Edit Unit</h4>
        </div>
        <button
          type="button"
          class="btn-close bg-danger text-white"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>

      <!-- 
        Note: action="" for now. JS will insert something like "/inventory/units/42/edit/"
      -->
      <form
        id="editUnitForm"
        method="POST"
        action=""
      >
        {% csrf_token %}
        <div class="modal-body">

          <!-- Hidden field for unit ID (optional if URL contains it) -->
          <input
            type="hidden"
            name="unit_id"
            id="edit-unit-id"
          />

          <div class="mb-3">
            <label for="edit-unit-name" class="form-label">
              Unit Name<span class="text-danger ms-1">*</span>
            </label>
            <input
              type="text"
              class="form-control"
              id="edit-unit-name"
              name="name"
              required
            />
          </div>

          <div class="mb-3">
            <label for="edit-unit-short-name" class="form-label">
              Short Name<span class="text-danger ms-1">*</span>
            </label>
            <input
              type="text"
              class="form-control"
              id="edit-unit-short-name"
              name="short_name"
              required
            />
          </div>

          <div class="mb-3">
            <div class="status-toggle d-flex justify-content-between align-items-center">
              <span class="status-label">Status</span>
              <input
                type="checkbox"
                id="edit-unit-status"
                name="status"
                class="check"
              />
              <label for="edit-unit-status" class="checktoggle"></label>
            </div>
          </div>

        </div>

        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Cancel
          </button>
          <button type="submit" class="btn btn-primary">Save Changes</button>
        </div>
      </form>

    </div>
  </div>
</div>

<!-- /Edit Unit -->

<!-- delete modal -->
<!-- Delete Unit Modal -->
<div class="modal fade" id="delete-unit-modal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="page-wrapper-new p-0">
        <div class="content p-5 px-3 text-center">
          <span class="rounded-circle d-inline-flex p-2 bg-danger-transparent mb-2">
            <i class="ti ti-trash fs-24 text-danger"></i>
          </span>
          <h4 class="fs-20 fw-bold mb-2 mt-1">Delete Unit</h4>
          <p class="mb-0 fs-16">
            Are you sure you want to delete <span id="delete-unit-name" class="fw-medium"></span>?
          </p>

          <!-- 
            action="" for now. JS will set it to something like "/inventory/units/42/delete/"
          -->
          <form id="deleteUnitForm" method="POST" action="">
            {% csrf_token %}
            <div class="modal-footer-btn mt-3 d-flex justify-content-center">
              <button
                type="button"
                class="btn btn-secondary fs-13 fw-medium p-2 px-3 shadow-none me-2"
                data-bs-dismiss="modal"
              >
                Cancel
              </button>
              <button type="submit" class="btn btn-danger fs-13 fw-medium p-2 px-3">
                Yes, Delete
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    //
    // 1) EDIT UNIT MODAL
    //
    var editUnitModal = document.getElementById('edit-unit-modal');
    if (editUnitModal) {
      editUnitModal.addEventListener('show.bs.modal', function (event) {
        // The <a class="btn-edit-unit"> that triggered this modal:
        var button = event.relatedTarget;

        // Read data-* attributes from that button
        var unitId        = button.getAttribute('data-id');
        var unitName      = button.getAttribute('data-name');
        var unitShortName = button.getAttribute('data-short-name');
        var unitStatus    = button.getAttribute('data-status'); // "true" or "false"

        // Get references to each input inside the modal
        var form          = document.getElementById('editUnitForm');
        var inputHiddenId = document.getElementById('edit-unit-id');
        var inputName     = document.getElementById('edit-unit-name');
        var inputShort    = document.getElementById('edit-unit-short-name');
        var inputStatus   = document.getElementById('edit-unit-status');

        // Populate hidden ID (if you need to send it in POST)
        if (inputHiddenId) {
          inputHiddenId.value = unitId;
        }

        // Populate name and short_name
        if (inputName) {
          inputName.value = unitName;
        }
        if (inputShort) {
          inputShort.value = unitShortName;
        }

        // Set the status checkbox:
        if (inputStatus) {
          inputStatus.checked = (unitStatus === 'true');
        }

        // Build the correct form.action URL.
        // In your Django template, write:
        //   {% url "inventory:edit-unit" 0 %}
        // which renders something like "/inventory/units/0/edit/".
        var editUrlTemplate = '{% url "inventory:edit-unit" 0 %}';
        // Replace the "/0/" segment with "/" + unitId + "/"
        var realEditUrl = editUrlTemplate.replace('/0/', '/' + unitId + '/');
        form.action = realEditUrl;
      });
    }

    //
    // 2) DELETE UNIT MODAL
    //
    var deleteUnitModal = document.getElementById('delete-unit-modal');
    if (deleteUnitModal) {
      deleteUnitModal.addEventListener('show.bs.modal', function (event) {
        var button   = event.relatedTarget;
        var unitId   = button.getAttribute('data-id');
        var unitName = button.getAttribute('data-name');

        // Write the unitName into the <span id="delete-unit-name">
        var namePlaceholder = document.getElementById('delete-unit-name');
        if (namePlaceholder) {
          namePlaceholder.textContent = unitName;
        }

        // Set the formâ€™s action URL to "/inventory/units/<id>/delete/"
        var form = document.getElementById('deleteUnitForm');
        var deleteUrlTemplate = '{% url "inventory:delete-unit" 0 %}';
        var realDeleteUrl     = deleteUrlTemplate.replace('/0/', '/' + unitId + '/');
        form.action = realDeleteUrl;
      });
    }
  });
</script>


{%endblock%}