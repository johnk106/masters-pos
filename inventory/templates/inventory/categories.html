{%extends 'landing/base.html'%}
{%load static%}


{%block head%}

<title>Categories</title>
{%endblock%}



{%block body%}
<div class="page-wrapper">
	<div class="content">
		<div class="page-header">
			<div class="add-item d-flex">
				<div class="page-title">
					<h4 class="fw-bold">Category</h4>
					<h6>Manage your categories</h6>
					<br>
					{% if messages %}
					{% for message in messages %}
					{% if message.tags == 'error' %}
					<!-- Error Alert -->
					<div class="alert alert-solid-danger alert-dismissible fade show">
						{{message}}
						<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"><i
								class="fas fa-xmark"></i></button>
					</div>
					{% elif message.tags == 'success' %}
					<!-- Success Alert -->
					<div class="alert alert-solid-success alert-dismissible fade show">
						{{message}}
						<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"><i
								class="fas fa-xmark"></i></button>
					</div>
					{% endif %}
					{% endfor %}
					{% endif %}
				</div>

			</div>

			<ul class="table-top-head">
				<li>
					<a data-bs-toggle="tooltip" data-bs-placement="top" title="Pdf" href="{{ export_pdf_url }}"><img
							src="{%static 'landing/assets/img/icons/pdf.svg'%}" alt="img"></a>
				</li>
				<li>
					<a data-bs-toggle="tooltip" data-bs-placement="top" title="Excel" href="{{ export_excel_url }}"><img
							src="{%static 'landing/assets/img/icons/excel.svg'%}" alt="img"></a>
				</li>
				<li>
					<a data-bs-toggle="tooltip" data-bs-placement="top" title="Refresh" href="{%url 'inventory:categories'%}"><i
							class="ti ti-refresh"></i></a>
				</li>
				<li>
					<a data-bs-toggle="tooltip" data-bs-placement="top" title="Collapse" id="collapse-header"><i
							class="ti ti-chevron-up"></i></a>
				</li>
			</ul>
			<div class="page-btn">
				<a href="#" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#add-category"><i
						class="ti ti-circle-plus me-1"></i>Add Category</a>
			</div>
		</div>
		<!-- /product list -->
		<div class="card">
			<div class="card-header d-flex align-items-center justify-content-between flex-wrap row-gap-3">
				<div class="search-set">
					<div class="search-input">
						<span class="btn-searchset"><i class="ti ti-search fs-14 feather-search"></i></span>
					</div>
				</div>
				<div class="d-flex table-dropdown my-xl-auto right-content align-items-center flex-wrap row-gap-3">
					<div class="dropdown">
						<a href="javascript:void(0);"
							class="dropdown-toggle btn btn-white btn-md d-inline-flex align-items-center"
							data-bs-toggle="dropdown">
							Status
						</a>
						<ul class="dropdown-menu  dropdown-menu-end p-3">
							<li>
								<a href="javascript:void(0);" class="dropdown-item rounded-1">Active</a>
							</li>
							<li>
								<a href="javascript:void(0);" class="dropdown-item rounded-1">Inactive</a>
							</li>
						</ul>
					</div>
				</div>
			</div>

			<div class="card-body p-0">
				<div class="table-responsive">
					<table class="table datatable">
						<thead class="thead-light">
							<tr>
								<th class="no-sort">
									<label class="checkboxs">
										<input type="checkbox" id="select-all">
										<span class="checkmarks"></span>
									</label>
								</th>
								<th>Category</th>
								<th>Category slug</th>
								<th>Created On</th>
								<th>Status</th>
								<th class="no-sort"></th>
							</tr>
						</thead>
						<tbody>
							{% for category in categories %}
							<tr>
								<td>
									<label class="checkboxs">
										<input type="checkbox">
										<span class="checkmarks"></span>
									</label>
								</td>
								<td><span class="text-gray-9">{{ category.name }}</span></td>
								<td>{{ category.slug }}</td>
								<td>{{ category.date_created }}</td>
								{% if category.status %}
								<td><span class="badge bg-success fw-medium fs-10">Active</span></td>
								{% else %}
								<td><span class="badge bg-secondary fw-medium fs-10">Inactive</span></td>
								{% endif %}
								<td class="action-table-data">
									<div class="edit-delete-action">
										<!-- EDIT BUTTON -->
										<a href="#" class="me-2 p-2 btn-edit-category" data-bs-toggle="modal"
											data-bs-target="#edit-category-modal" data-id="{{ category.id }}"
											data-name="{{ category.name }}" data-slug="{{ category.slug }}"
											data-status="{{ category.status|yesno:'true,false' }}">
											<i data-feather="edit" class="feather-edit"></i>
										</a>

										<!-- DELETE BUTTON -->
										<a href="#" class="p-2 btn-delete-category" data-bs-toggle="modal"
											data-bs-target="#delete-category-modal" data-id="{{ category.id }}"
											data-name="{{ category.name }}">
											<i data-feather="trash-2" class="feather-trash-2"></i>
										</a>
									</div>
								</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			</div>
		</div>
		<!-- /product list -->
	</div>
	<div class="footer d-sm-flex align-items-center justify-content-between border-top bg-white p-3">
		<p class="mb-0 text-gray-9">22025 &copy; Twoven Ecommerce. All Right Reserved</p>
		<p>Designed &amp; Developed by <a href="javascript:void(0);" class="text-primary">Twoven</a></p>
	</div>
</div>
<!-- Add Category -->
<div class="modal fade" id="add-category">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-header">
				<div class="page-title">
					<h4>Add Category</h4>
				</div>
				<button type="button" class="close bg-danger text-white fs-16" data-bs-dismiss="modal"
					aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<form action="{%url 'inventory:create-category'%}" method="POST">
				{%csrf_token%}
				<div class="modal-body">
					<div class="mb-3">
						<label class="form-label">Category<span class="text-danger ms-1">*</span></label>
						<input type="text" name="name" class="form-control">
					</div>
					<div class="mb-3">
						<label class="form-label">Category Slug<span class="text-danger ms-1">*</span></label>
						<input type="text" name="slug" class="form-control">
					</div>
					<div class="mb-0">
						<div class="status-toggle modal-status d-flex justify-content-between align-items-center">
							<span class="status-label">Status<span class="text-danger ms-1">*</span></span>
							<input type="checkbox" id="user2" class="check" checked="">
							<label for="user2" class="checktoggle"></label>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn me-2 btn-secondary" data-bs-dismiss="modal">Cancel</button>
					<button type="submit" class="btn btn-primary">Add Category</button>
				</div>
			</form>
		</div>
	</div>
</div>
<!-- /Add Category -->

<!-- Edit Category -->
<!-- Edit Category Modal -->
<div class="modal fade" id="edit-category-modal" tabindex="-1" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title">Edit Category</h4>
				<button type="button" class="btn-close bg-danger text-white" data-bs-dismiss="modal"
					aria-label="Close"></button>
			</div>

			<!-- Notice: action="" for now. We'll fill it via JavaScript. -->
			<form id="editCategoryForm" method="POST" action="">
				{% csrf_token %}
				<div class="modal-body">
					<!-- Hidden field for category ID (optional if you put the ID in the URL) -->
					<input type="hidden" name="category_id" id="edit-category-id" />

					<div class="mb-3">
						<label for="edit-name" class="form-label">Category Name<span
								class="text-danger ms-1">*</span></label>
						<input type="text" class="form-control" id="edit-name" name="name" required />
					</div>

					<div class="mb-3">
						<label for="edit-slug" class="form-label">Category Slug<span
								class="text-danger ms-1">*</span></label>
						<input type="text" class="form-control" id="edit-slug" name="slug" required />
					</div>

					<div class="mb-3">
						<label class="form-label">Status<span class="text-danger ms-1">*</span></label>
						<div class="status-toggle d-flex justify-content-between align-items-center">
							<span class="status-label">Active</span>
							<input type="checkbox" id="edit-status" name="status" class="check" />
							<label for="edit-status" class="checktoggle"></label>
						</div>
					</div>
				</div>

				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
						Cancel
					</button>
					<button type="submit" class="btn btn-primary">Save Changes</button>
				</div>
			</form>
		</div>
	</div>
</div>


<!-- delete modal -->
<!-- Delete Category Modal -->
<div class="modal fade" id="delete-category-modal" tabindex="-1" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title">Delete Category</h4>
				<button type="button" class="btn-close bg-danger text-white" data-bs-dismiss="modal"
					aria-label="Close"></button>
			</div>

			<form id="deleteCategoryForm" method="POST" action="">
				{% csrf_token %}
				<div class="modal-body text-center">
					<span class="rounded-circle d-inline-flex p-2 bg-danger-transparent mb-2">
						<i class="ti ti-trash fs-24 text-danger"></i>
					</span>
					<h5 class="mb-2">Are you sure you want to delete</h5>
					<p id="delete-category-name" class="fw-bold fs-16 mb-0"></p>
				</div>

				<div class="modal-footer d-flex justify-content-center">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
						Cancel
					</button>
					<button type="submit" class="btn btn-danger">Yes, Delete</button>
				</div>
			</form>
		</div>
	</div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    // 1) EDIT‐CATEGORY MODAL
    var editModal = document.getElementById('edit-category-modal');
    if (editModal) {
      editModal.addEventListener('show.bs.modal', function (event) {
        // `event.relatedTarget` is the button/link that triggered the modal
        var button = event.relatedTarget;

        // Read data-* attributes from the button
        var categoryId = button.getAttribute('data-id');
        var categoryName = button.getAttribute('data-name');
        var categorySlug = button.getAttribute('data-slug');
        var categoryStatus = button.getAttribute('data-status'); // "true" or "false"

        // Find the form and inputs inside the modal
        var form = document.getElementById('editCategoryForm');
        var inputId = document.getElementById('edit-category-id');
        var inputName = document.getElementById('edit-name');
        var inputSlug = document.getElementById('edit-slug');
        var inputStatus = document.getElementById('edit-status');

        // 1a) Populate the hidden ID field (if you’re sending the ID via POST body)
        if (inputId) {
          inputId.value = categoryId;
        }

        // 1b) Fill in the text inputs
        if (inputName) {
          inputName.value = categoryName;
        }
        if (inputSlug) {
          inputSlug.value = categorySlug;
        }

        // 1c) Set the checkbox based on data-status:
        if (inputStatus) {
          // categoryStatus is a string "true" or "false"
          inputStatus.checked = (categoryStatus === 'true');
        }

        // 1d) Finally: set the form’s action URL to include the id.
        //    E.g. if your URL pattern is named 'inventory:edit-category' and expects an <int:id>:
        //
        //    /inventory/categories/42/edit/
        //
        //    You can build that string in JS. If you know the exact URL prefix:
        //    var editUrl = '/inventory/categories/' + categoryId + '/edit/';
        //    form.action = editUrl;
        //
        //    Or, if you want to keep things dynamic with Django’s  you can
        //    render a “template string” in a data-attribute on the page. For simplicity:
        //
        var editUrl = '{% url "inventory:edit-category" 0 %}';
        // The above will render (for example): "/inventory/categories/0/edit/"
        // So we just replace the trailing "0" with the real categoryId:
        editUrl = editUrl.replace('/0/', '/' + categoryId + '/');
        form.action = editUrl;
      });
    }

    // 2) DELETE‐CATEGORY MODAL
    var deleteModal = document.getElementById('delete-category-modal');
    if (deleteModal) {
      deleteModal.addEventListener('show.bs.modal', function (event) {
        var button = event.relatedTarget;
        var categoryId = button.getAttribute('data-id');
        var categoryName = button.getAttribute('data-name');

        // Update the “Are you sure?” text:
        var namePlaceholder = document.getElementById('delete-category-name');
        if (namePlaceholder) {
          namePlaceholder.textContent = '"' + categoryName + '"';
        }

        // Set the form action to the delete‐URL:
        var form = document.getElementById('deleteCategoryForm');
        // Suppose your URL name is 'inventory:delete-category' and expects <int:id>:
        var deleteUrl = '{% url "inventory:delete-category" 0 %}';
        deleteUrl = deleteUrl.replace('/0/', '/' + categoryId + '/');
        form.action = deleteUrl;
      });
    }
  });
</script>

{%endblock%}